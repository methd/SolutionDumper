<Window x:Class="SolutionDumper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:SolutionDumper.ViewModels"
        xmlns:conv="clr-namespace:SolutionDumper.Converters"
        Title="Solution Dumper" Height="750" Width="1200">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <conv:BoolToGrayBrushConverter x:Key="BoolToGrayConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Margin="10" Grid.Row="0" LastChildFill="False">
            <Button Content="Open .sln"
                    Width="120"
                    Margin="0,0,10,0"
                    Command="{Binding OpenSlnCommand}"/>
            <TextBlock VerticalAlignment="Center"
                       Text="{Binding SlnPath}"
                       Margin="0,0,15,0"/>
        </DockPanel>

        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="10">
                <DockPanel LastChildFill="True">

                    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                        <TextBlock Text="Filter tree:"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,4"/>

                        <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="6,3"
                                 FontSize="13"
                                 VerticalContentAlignment="Center"/>

                        <TextBlock Text="Matches file / folder / project name or path"
                                   Opacity="0.6"
                                   FontSize="11"
                                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <TreeView ItemsSource="{Binding Roots}">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="{x:Type TreeViewItem}">
                                <Setter Property="IsExpanded"
                                        Value="{Binding IsExpanded, Mode=TwoWay}" />
                                <Setter Property="Visibility"
                                        Value="{Binding IsVisible, Converter={StaticResource BoolToVis}}"/>
                            </Style>
                        </TreeView.ItemContainerStyle>

                        <TreeView.Resources>
                            <HierarchicalDataTemplate DataType="{x:Type vm:TreeNodeViewModel}"
                                                      ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal"
                                            ToolTip="{Binding Tooltip}">

                                    <CheckBox IsThreeState="{Binding HasChildren}"
                                              IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                              IsEnabled="{Binding IsSelectable}"
                                              VerticalAlignment="Center"/>

                                    <TextBlock Text="{Binding DisplayName}"
                                               Margin="6,0,0,0"
                                               Foreground="{Binding IsSelectable, Converter={StaticResource BoolToGrayConverter}}"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.Resources>
                    </TreeView>
                </DockPanel>
            </Border>

            <Border Grid.Column="1"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="10"
                    Margin="10,0,0,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top"
                                Orientation="Horizontal"
                                Margin="0,0,0,10">
                        <TextBlock Text="Selected files:"
                                   FontWeight="SemiBold"
                                   Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding SelectedFileCount}"/>
                        <TextBlock Text="  |  Total size:"
                                   Margin="15,0,5,0"/>
                        <TextBlock Text="{Binding SelectedTotalSizeText}"/>
                    </StackPanel>

                    <ListBox ItemsSource="{Binding SelectedFiles}"
                             VirtualizingPanel.IsVirtualizing="True"
                             VirtualizingPanel.VirtualizationMode="Recycling"/>
                </DockPanel>
            </Border>
        </Grid>

        <Grid Margin="10" Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <WrapPanel Grid.Column="0"
               Orientation="Horizontal">

                <WrapPanel.Resources>
                    <Style TargetType="Button">
                        <Setter Property="MinWidth" Value="120"/>
                        <Setter Property="Margin" Value="0,0,8,8"/>
                    </Style>
                </WrapPanel.Resources>

                <Button Content="Export…"
                Command="{Binding ExportCommand}" />

                <Button Content="Copy to Clipboard"
                Command="{Binding CopyToClipboardCommand}" />

            </WrapPanel>

            <TextBlock Grid.Column="1"
                       Text="{Binding StatusText}"
                       VerticalAlignment="Center"
                       Margin="12,0,0,0"
                       FontStyle="Italic">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Foreground" Value="Gray"/>
                        <Setter Property="Visibility" Value="Collapsed"/>

                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasStatus}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding StatusKind}" Value="Success">
                                <Setter Property="Foreground" Value="Green"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding StatusKind}" Value="Warning">
                                <Setter Property="Foreground" Value="DarkOrange"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding StatusKind}" Value="Error">
                                <Setter Property="Foreground" Value="Crimson"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </Grid>
    </Grid>
</Window>